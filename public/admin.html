<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Admin Panel)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; background-color: #f9f9f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select, button, textarea { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; padding: 10px; }
        button:hover { background-color: #0056b3; }
        .delete-btn { background-color: #dc3545; width: auto; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .music-card { border-left: 5px solid #28a745; }
    </style>
</head>
<body>

    <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö Trivia</h1>

    <div class="card">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)</h3>
        <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏© (3 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢):</label>
        <input type="text" id="special-message" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
        
        <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
        <input type="number" id="setting-q-time" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 120 (‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 2 ‡∏ô‡∏≤‡∏ó‡∏µ)">
        
        <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏•‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
        <input type="number" id="setting-a-time" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 60 (‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 1 ‡∏ô‡∏≤‡∏ó‡∏µ)">
        
        <button onclick="updateSettings()" style="background-color: #6c757d; margin-top: 10px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
    </div>

    <div class="card music-card">
        <h3>üéµ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (MP3 URLs)</h3>
        <p style="font-size: 0.9em; color: gray;">‡∏ô‡∏≥‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå .mp3 ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏°‡∏≤‡∏ß‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</p>
        <input type="text" id="track-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏•‡∏á‡∏ä‡∏¥‡∏•‡πÜ)">
        <input type="text" id="track-url" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå MP3 (‡πÄ‡∏ä‡πà‡∏ô https://example.com/song.mp3)">
        <button onclick="addTrack()" style="background-color: #28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</button>
        
        <table>
            <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á</th><th>‡∏•‡∏¥‡∏á‡∏Å‡πå (URL)</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
            <tbody id="tracks-table-body"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
        <input type="text" id="q-text" placeholder="‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡πÄ‡∏ä‡πà‡∏ô 1+1 ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?">
        
        <input type="text" id="q-opt1" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 1">
        <input type="text" id="q-opt2" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 2">
        <input type="text" id="q-opt3" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 3">
        <input type="text" id="q-opt4" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 4">
        
        <select id="q-answer">
            <option value="0">‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 1</option>
            <option value="1">‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 2</option>
            <option value="2">‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 3</option>
            <option value="3">‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 4</option> 
        </select>
        
        <textarea id="q-explanation" rows="3" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏ï‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ?)"></textarea>
        <button onclick="addQuestion()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</button>
    </div>

    <div class="card">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <table>
            <thead><tr><th>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th><th>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‚úÖ ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏π‡∏Å)</th><th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
            <tbody id="questions-table-body"></tbody>
        </table>
    </div>

    <script>
        const API_URL = '/api'; // ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏•‡∏á ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        window.onload = () => { fetchSettings(); fetchQuestions(); fetchTracks(); };

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Settings) ---
        async function fetchSettings() {
            const res = await fetch(`${API_URL}/settings`);
            const data = await res.json();
            document.getElementById('special-message').value = data.specialMessage || '';
            document.getElementById('setting-q-time').value = data.questionTime;
            document.getElementById('setting-a-time').value = data.answerTime;
        }

        async function updateSettings() {
            const specialMessage = document.getElementById('special-message').value;
            const questionTime = parseInt(document.getElementById('setting-q-time').value);
            const answerTime = parseInt(document.getElementById('setting-a-time').value);
            
            if (!questionTime || !answerTime) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");

            await fetch(`${API_URL}/settings`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ specialMessage, questionTime, answerTime })
            });
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏•‡∏á ---
        async function fetchTracks() {
            const res = await fetch(`${API_URL}/tracks`);
            const tracks = await res.json();
            const tbody = document.getElementById('tracks-table-body');
            tbody.innerHTML = tracks.map(t => `
                <tr><td>${t.name}</td><td style="word-break: break-all; font-size:0.8em;">${t.url}</td>
                <td><button class="delete-btn" onclick="deleteTrack(${t.id})">‡∏•‡∏ö</button></td></tr>
            `).join('');
        }

        async function addTrack() {
            const name = document.getElementById('track-name').value;
            const url = document.getElementById('track-url').value;
            if (!name || !url) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            await fetch(`${API_URL}/tracks`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name, url})});
            document.getElementById('track-name').value = ''; document.getElementById('track-url').value = '';
            fetchTracks();
        }

        async function deleteTrack(id) {
            if(confirm('‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ?')) { await fetch(`${API_URL}/tracks/${id}`, { method: 'DELETE' }); fetchTracks(); }
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ---
        async function fetchQuestions() {
            const res = await fetch(`${API_URL}/questions`);
            const questions = await res.json();
            const tbody = document.getElementById('questions-table-body');
            tbody.innerHTML = questions.map(q => {
                const options = q.options.map((o, i) => i === q.answerIndex ? `‚úÖ ${o}` : o).join('<br>');
                return `<tr><td>${q.text}</td><td>${options}</td><td>${q.explanation || '-'}</td>
                <td><button class="delete-btn" onclick="deleteQuestion(${q.id})">‡∏•‡∏ö</button></td></tr>`;
            }).join('');
        }
        
        async function addQuestion() {
            const text = document.getElementById('q-text').value;
            const options = [
                document.getElementById('q-opt1').value, 
                document.getElementById('q-opt2').value, 
                document.getElementById('q-opt3').value,
                document.getElementById('q-opt4').value
            ];
            const answerIndex = parseInt(document.getElementById('q-answer').value);
            const explanation = document.getElementById('q-explanation').value;

            if (!text || !options[0] || !options[1] || !options[2] || !options[3]) {
                return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 4 ‡∏Ç‡πâ‡∏≠');
            }

            await fetch(`${API_URL}/questions`, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({text, options, answerIndex, explanation})
            });
            
            document.getElementById('q-text').value = ''; 
            document.getElementById('q-opt1').value = ''; 
            document.getElementById('q-opt2').value = ''; 
            document.getElementById('q-opt3').value = ''; 
            document.getElementById('q-opt4').value = ''; 
            document.getElementById('q-explanation').value = '';
            fetchQuestions();
        }

        async function deleteQuestion(id) {
            if (confirm('‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ?')) { await fetch(`${API_URL}/questions/${id}`, { method: 'DELETE' }); fetchQuestions(); }
        }
    </script>
</body>
</html>